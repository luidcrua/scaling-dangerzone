// Generated by CoffeeScript 1.6.3
(function() {
  Lungo.ready(function() {
    $$("section").on("swipeRight", function(event) {
      return Lungo.Router.back();
    });
    /*
    	# EL TEMA DEL SCROLL PARA CUADRAR EL CSS DEL "ELEGIDO"
    	["singleTap", "doubleTap", "hold",
    	"swipe", "-swiping", "swipeLeft", "swipeRight", "swipeUp", "swipeDown",
    	"rotate", "rotateLeft", "rotateRight",
    	"pinch", "pinchIn", "pinchOut",
    	"drag", "dragLeft", "dragRight", "dragUp", "dragDown"].forEach (type) ->
    		$$("#main-article").on type, (event) ->
    			if window.plenoCambio isnt true
    				# console.log document.getElementById("main-article").scrollTop
    				liActivo = Math.floor (document.getElementById("main-article").scrollTop + ($$(".imgGrandes").width() / 3)) / ($$(".imgGrandes").width() / 2)
    				$$("#main-article ul li").removeClass "shadow"
    				$$("#main-article ul li img").removeClass "noSeleccionada"
    				$$("#main-article ul li img").addClass "noSeleccionada"
    				# console.log liActivo
    				objLiActivo = $$("#main-article ul").children()[liActivo]
    				$$(objLiActivo).children().first().removeClass "noSeleccionada"
    				$$(objLiActivo).addClass "shadow"
    				# console.log $$("#main-article ul").children()[liActivo]
    				# window.plenoCambio = true
    */

    $$('#main-article img').tap(function(event) {
      TweenMax.from($$("#imageBolsas"), 2, {
        bottom: "-100%",
        ease: Expo.easeOut
      });
      TweenMax.from($$("#imageGlobo"), 2, {
        bottom: "-100%",
        ease: Expo.easeOut
      });
      window.cenComercialSel = $$(this).attr('data-title');
      window.cambioTitulo(window.cenComercialSel);
      return window.cambiaIcono(window.cenComercialSel);
    });
    /*
    	cargaTituloCenComercial = (event) ->
    		$$('#cenComMenu h1.title').html window.cenComercialSel
    */

    $$('#centroComercial article#layout-art2 div#listCat ul li').tap(function(event) {
      var idCategoria;
      idCategoria = parseInt($$(this).attr('data-id'));
      return window.getComercioXCategoria(idCategoria);
    });
    $$('#subcategorias article#layout-art2 div#list ul li').tap(function(event) {
      var idComercio;
      idComercio = parseInt($$(this).attr('data-id'));
      return getPromoXComercio(idComercio);
    });
    $$('.shareBt').tap(function(event) {
      /*
      		Lungo.Notification.show();
      		Lungo.Notification.html '<div class="cont-share "><h2>Share</h2>  <ul>  	<li><a href="http://www.facebook.com/sharer/sharer.php?u=http://www.mukuralab.com/appmall/kumbia/aplicacion/index/Santa_fe/Arturo_calle/Vestidos/" target="_blank"><img src="app/resources/images/share-icons/fbk-icon.png"/></a></li>  	<li><a href="https://twitter.com/intent/tweet?text=Mira%20esta%20promo&url=http%3A%2F%2Fwww.mukuralab.com%2Fappmall%2Fkumbia%2Faplicacion%2Findex%2FSanta_fe%2FArturo_calle%2FVestidos%2F" target="_blank"><img src="app/resources/images/share-icons/twt-icon.png"/></a></li>  	<li><a href="javascript:void((function()%7Bvar%20e=document.createElement(&apos;script&apos;);e.setAttribute(&apos;type&apos;,&apos;text/javascript&apos;);e.setAttribute(&apos;charset&apos;,&apos;UTF-8&apos;);e.setAttribute(&apos;src&apos;,&apos;http://assets.pinterest.com/js/pinmarklet.js?r=&apos;+Math.random()*99999999);document.body.appendChild(e)%7D)());"><img src="app/resources/images/share-icons/pint-icon.png"/></a></li>  	<li><a href="mailto:?subject=Mira esta promo&body=http://www.mukuralab.com/appmall/kumbia/aplicacion/index/Santa_fe/Arturo_calle/Vestidos/" target="_blank"><img src="app/resources/images/share-icons/email-icon.png"/></a></li>  	<li><a href="https://plus.google.com/share?url=http%3A%2F%2Fwww.mukuralab.com%2Fappmall%2Fkumbia%2Faplicacion%2Findex%2FSanta_fe%2FArturo_calle%2FVestidos%2F" target="_blank"><img src="app/resources/images/share-icons/gplus-icon.png"/></a></li>  	<!--li><img src="app/resources/images/share-icons/noshare-icon.png"/></li-->  </ul><img src="app/resources/images/share-icons/close.png" class="close-share"/> </div>'
      */

      var nomCenCom, nomComercio, nomPromo;
      Lungo.Aside.show("share");
      nomCenCom = window.cenComercialSel.ucfirst();
      nomComercio = window.comercioSel.nombre.ucfirst();
      nomPromo = $$(this).parent().siblings("h2").html().ucfirst();
      return $$('a[data-action=share]').forEach(function(linkAside) {
        switch ($$(linkAside).attr("data-type")) {
          case "facebook":
            return $$(linkAside).attr("href", "http://www.facebook.com/sharer/sharer.php?u=http://www.mukuralab.com/appmall/kumbia/aplicacion/index/" + nomCenCom + "/" + nomComercio + "/" + nomPromo + "/");
          case "twitter":
            return $$(linkAside).attr("href", "https://twitter.com/intent/tweet?text=Mira%20esta%20promo&url=http%3A%2F%2Fwww.mukuralab.com%2Fappmall%2Fkumbia%2Faplicacion%2Findex%2F" + nomCenCom + "%2F" + nomComercio + "%2F" + nomPromo + "%2F");
          case "pinterest":
            return $$(linkAside).attr("href", "javascript:void((function()%7Bvar%20e=document.createElement(&apos;script&apos;);e.setAttribute(&apos;type&apos;,&apos;text/javascript&apos;);e.setAttribute(&apos;charset&apos;,&apos;UTF-8&apos;);e.setAttribute(&apos;src&apos;,&apos;http://assets.pinterest.com/js/pinmarklet.js?r=&apos;+Math.random()*99999999);document.body.appendChild(e)%7D)());");
          case "mail":
            return $$(linkAside).attr("href", "mailto:?subject=Mira esta promo&body=http://www.mukuralab.com/appmall/kumbia/aplicacion/index/" + nomCenCom + "/" + nomComercio + "/" + nomPromo + "/");
          case "gplus":
            return $$(linkAside).attr("href", "https://plus.google.com/share?url=http%3A%2F%2Fwww.mukuralab.com%2Fappmall%2Fkumbia%2Faplicacion%2Findex%2F" + nomCenCom + "%2F" + nomComercio + "%2F" + nomPromo + "%2F");
        }
      });
    });
    $$('.closeAside').tap(function(event) {
      return Lungo.Aside.hide();
    });
    $$('.close-share').tap(function(event) {
      return Lungo.Notification.hide();
    });
    $$('.heartLike').tap(function(event) {
      var actualVotos, cenComercialId, comercioId, iconoActual, nextState, promocionId;
      iconoActual = this;
      nextState = $$(this).children().first().hasClass("heart-empty");
      promocionId = parseInt($$(this).parent().parent().parent().parent().attr('data-id'));
      actualVotos = parseInt($$(this).siblings().last().html());
      cenComercialId = parseInt(window.arreCenComerciales.indexOf(window.cenComercialSel));
      comercioId = parseInt(window.comercioSel.id);
      if (nextState) {
        return $$.post('http://www.mukuralab.com/appmall/kumbia/json/usuarioGustoPromocion', {
          proximoEstado: nextState,
          error: '1',
          idUsuarioEnvia: 1,
          idComercio: comercioId,
          idCentroComercial: cenComercialId,
          idPromocion: promocionId
        }, function(data) {
          console.log(data.idError);
          if (data.idError === "0" || data.idError === 0) {
            console.log(iconoActual);
            $$(iconoActual).children().first().removeClass("icon");
            $$(iconoActual).children().first().removeClass("heart-empty");
            $$(iconoActual).children().first().addClass("icon heart");
            actualVotos = actualVotos + 1;
            return $$(iconoActual).siblings().last().html(actualVotos.toString());
          }
        });
      } else {
        return $$.post('http://www.mukuralab.com/appmall/kumbia/json/usuarioNoGustoPromocion', {
          proximoEstado: nextState,
          error: '1',
          idUsuarioEnvia: 1,
          idComercio: comercioId,
          idCentroComercial: cenComercialId,
          idPromocion: promocionId
        }, function(data) {
          if (data.idError === "0" || data.idError === 0) {
            $$(iconoActual).children().first().removeClass("icon");
            $$(iconoActual).children().first().removeClass("heart");
            $$(iconoActual).children().first().addClass("icon heart-empty");
            actualVotos = actualVotos - 1;
            return $$(iconoActual).siblings().last().html(actualVotos.toString());
          }
        });
      }
    });
    $$('.contPost img').tap(function(event) {
      var sectionId, view;
      $$(".promoInterna").empty();
      console.log($$(this).closest("section"));
      sectionId = $$(this).closest("section").attr('id');
      switch (sectionId) {
        case "almacen1":
          view = new __View.PromocionInterna({
            model: __Model.Promocion
          });
          view.append(__Model.Promocion.findBy("id", parseInt($$(this).parent().parent().attr('data-id'))));
          return Lungo.Router.article("almacen2", "interna");
        case "eventos":
          /*
          				view = new __View.EvenDestaInterna model: __Model.Evento
          				view.append __Model.Evento.findBy "id", parseInt $$(this).parent().parent().attr 'data-id'
          				Lungo.Router.article "almacen3", "evenDestaInterna"
          */

          break;
        default:
          view = new __View.EvenDestaInterna({
            model: __Model.Promocion
          });
          view.append(__Model.Promocion.findBy("id", parseInt($$(this).parent().parent().attr('data-id'))));
          return Lungo.Router.article("almacen3", "evenDestaInterna");
      }
      /*
      		if sectionId isnt "almacen1"
      			view = new __View.EvenDestaInterna model: __Model.Promocion
      			view.append __Model.Promocion.findBy "id", parseInt $$(this).parent().parent().attr 'data-id'
      			Lungo.Router.article "almacen3", "evenDestaInterna"
      		else
      			view = new __View.PromocionInterna model: __Model.Promocion
      			view.append __Model.Promocion.findBy "id", parseInt $$(this).parent().parent().attr 'data-id'
      			Lungo.Router.article "almacen2", "interna"
      */

    });
    $$('.btnSuperPromo').tap(function(event) {
      var cenComercialId, comercioId, promoId;
      Lungo.Notification.show();
      cenComercialId = parseInt(window.arreCenComerciales.indexOf(window.cenComercialSel));
      comercioId = parseInt(window.comercioSel.id);
      promoId = parseInt($$(this).parent().parent().attr('data-id'));
      console.log({
        idUsuario: 1,
        idComercio: parseInt(window.comercioSel.id, {
          idCentroComercial: cenComercialId,
          idPromocion: parseInt(promoId)
        })
      });
      return $$.post('http://www.mukuralab.com/appmall/kumbia/json/registroSuperPromo', {
        idUsuario: 1,
        idCentroComercial: cenComercialId,
        idPromocion: promoId,
        idComercio: comercioId
      }, function(data) {
        console.log(data);
        switch (data.idError) {
          case "0":
          case 0:
            Lungo.Notification.show();
            window.setTimeout(window.changeSuperPromo, 300);
            return Lungo.Notification.success("Super Promoción", "Tu código es: " + data.codigo, "ok", 0);
          case "2":
          case 2:
            Lungo.Notification.show();
            window.setTimeout(window.changeSuperPromo, 300);
            return Lungo.Notification.success("Super Promoción", "Ya tienes un código para esta promoción, es: " + data.codigo, "ok", 0);
          case "1":
          case 1:
            Lungo.Notification.show();
            return Lungo.Notification.error("Super Promoción", "Ocurrió un error, intenta nuevamente", "remove", 0);
        }
      });
    });
    ["a[data-label=Destacados]", "#btnDestacados"].forEach(function(linkType) {
      return $$(linkType).tap(function(event) {
        var cenComercialId, promoPorComercio;
        $$('section#destacados article#artDestacados div#listDestacados').empty();
        promoPorComercio = __Model.Promocion.byComercioCenCom(1, 1);
        console.log(promoPorComercio);
        Lungo.Notification.show();
        cenComercialId = parseInt(window.arreCenComerciales.indexOf(window.cenComercialSel));
        return $$.post('http://www.mukuralab.com/appmall/kumbia/json/promocionDestacada/' + cenComercialId.toString(), {
          error: 1
        }, function(data) {
          var promo, _fn, _i, _len;
          console.log(data);
          Lungo.Notification.hide();
          _fn = function(promo) {
            var view;
            __Model.Promocion.addPromocion(promo);
            view = new __View.Destacado({
              model: __Model.Promocion
            });
            return view.append(__Model.Promocion.findBy("id", parseInt(promo.id)));
          };
          for (_i = 0, _len = data.length; _i < _len; _i++) {
            promo = data[_i];
            _fn(promo);
          }
          return Lungo.Router.section("destacados");
        });
      });
    });
    ["a[data-label=Eventos]", "#btnEventos"].forEach(function(linkType) {
      return $$(linkType).tap(function(event) {
        var cenComercialId;
        $$('section#eventos article#artEventos div#listEventos').empty();
        Lungo.Notification.show();
        cenComercialId = parseInt(window.arreCenComerciales.indexOf(window.cenComercialSel));
        return $$.post('http://www.mukuralab.com/appmall/kumbia/json/eventoCentroComercial/' + cenComercialId.toString(), {
          error: 1
        }, function(data) {
          var evento, _fn, _i, _len;
          console.log(data);
          Lungo.Notification.hide();
          _fn = function(evento) {
            var view;
            __Model.Evento.addEvento(evento);
            view = new __View.Evento({
              model: __Model.Evento
            });
            return view.append(__Model.Evento.findBy("id", parseInt(evento.id)));
          };
          for (_i = 0, _len = data.length; _i < _len; _i++) {
            evento = data[_i];
            _fn(evento);
          }
          return Lungo.Router.section("eventos");
        });
      });
    });
    __Model.Usuario.create({
      id: 1,
      nombre: "Ropa Masculina"
    });
    __Model.Categoria.create({
      id: 1,
      nombre: "Ropa Masculina",
      visible: true
    });
    __Model.Categoria.create({
      id: 2,
      nombre: "Ropa Femenina",
      visible: true
    });
    __Model.Categoria.create({
      id: 3,
      nombre: "Ropa infantil",
      visible: true
    });
    __Model.Categoria.create({
      id: 4,
      nombre: "Mascotas",
      visible: true
    });
    __Model.Categoria.create({
      id: 5,
      nombre: "Cinemas",
      visible: true
    });
    __Model.Categoria.create({
      id: 6,
      nombre: "Juguetes",
      visible: true
    });
    __Model.Categoria.create({
      id: 7,
      nombre: "Variedades",
      visible: true
    });
    __Model.Categoria.create({
      id: 8,
      nombre: "Comidas",
      visible: true
    });
    __Model.Categoria.create({
      id: 9,
      nombre: "Tecnologia",
      visible: true
    });
    __Model.Categoria.create({
      id: 10,
      nombre: "Música",
      visible: false
    });
    __Model.Promocion.create({
      id: 404,
      idComercio: 2,
      idCenComercial: 2,
      titulo: "Titulo destacado post",
      descripcion: "Descripción de la promoción",
      imagen: "app/resources/images/promos/image3.jpg",
      meGusta: 15,
      fechaInicioPublicacion: "2013-12-14",
      fechaFinPublicacion: "2014-01-21",
      gustaUsuario: "heart-empty",
      superPromo: false,
      cantidad: 3,
      promoDestacada: false,
      visible: true
    });
    __Model.Promocion.create({
      id: 405,
      idComercio: 1,
      idCenComercial: 1,
      titulo: "Destacado 1",
      descripcion: "Tienda 2",
      imagen: "app/resources/images/promos/destacados1.jpg",
      meGusta: 28,
      fechaInicioPublicacion: "2014-01-14",
      fechaFinPublicacion: "2014-01-19",
      gustaUsuario: "heart-empty",
      superPromo: false,
      cantidad: 3,
      promoDestacada: false,
      visible: true
    });
    __Model.Promocion.create({
      id: 406,
      idComercio: 1,
      idCenComercial: 1,
      titulo: "Destacado 2",
      descripcion: "Tienda 4",
      imagen: "app/resources/images/promos/destacados2.jpg",
      meGusta: 28,
      fechaInicioPublicacion: "2014-01-14",
      fechaFinPublicacion: "2014-01-19",
      gustaUsuario: "heart-empty",
      superPromo: false,
      cantidad: 3,
      promoDestacada: false,
      visible: true
    });
    __Model.Promocion.create({
      id: 407,
      idComercio: 1,
      idCenComercial: 1,
      titulo: "Destacado 3",
      descripcion: "Tienda 1",
      imagen: "app/resources/images/promos/destacados3.jpg",
      meGusta: 28,
      fechaInicioPublicacion: "2014-01-14",
      fechaFinPublicacion: "2014-01-19",
      gustaUsuario: "heart-empty",
      superPromo: false,
      cantidad: 3,
      promoDestacada: false,
      visible: true
    });
    __Model.Promocion.create({
      id: 408,
      idComercio: 1,
      idCenComercial: 1,
      titulo: "Destacado 4",
      descripcion: "Tienda 3",
      imagen: "app/resources/images/promos/destacados4.jpg",
      meGusta: 28,
      fechaInicioPublicacion: "2014-01-14",
      fechaFinPublicacion: "2014-01-19",
      gustaUsuario: "heart-empty",
      superPromo: false,
      cantidad: 3,
      promoDestacada: false,
      visible: true
    });
    __Model.Promocion.create({
      id: 409,
      idComercio: 1,
      idCenComercial: 1,
      titulo: "Evento 1",
      descripcion: "",
      imagen: "app/resources/images/eventos/eventos1.jpg",
      meGusta: 4,
      fechaInicioPublicacion: "2014-01-14",
      fechaFinPublicacion: "2014-01-19",
      gustaUsuario: "heart-empty",
      superPromo: false,
      cantidad: 3,
      promoDestacada: false,
      visible: true
    });
    __Model.Promocion.create({
      id: 4010,
      idComercio: 1,
      idCenComercial: 1,
      titulo: "Evento 2",
      descripcion: "",
      imagen: "app/resources/images/eventos/eventos2.jpg",
      meGusta: 11,
      fechaInicioPublicacion: "2014-01-14",
      fechaFinPublicacion: "2014-01-19",
      gustaUsuario: "heart-empty",
      superPromo: false,
      cantidad: 3,
      promoDestacada: false,
      visible: true
    });
    __Model.Promocion.create({
      id: 4011,
      idComercio: 1,
      idCenComercial: 1,
      titulo: "Evento 3",
      descripcion: "",
      imagen: "app/resources/images/eventos/eventos3.jpg",
      meGusta: 12,
      fechaInicioPublicacion: "2014-01-14",
      fechaFinPublicacion: "2014-01-19",
      gustaUsuario: "heart-empty",
      superPromo: false,
      cantidad: 3,
      promoDestacada: false,
      visible: true
    });
    __Model.Promocion.create({
      id: 4012,
      idComercio: 1,
      idCenComercial: 1,
      titulo: "Evento 4",
      descripcion: "",
      imagen: "app/resources/images/eventos/eventos4.jpg",
      meGusta: 15,
      fechaInicioPublicacion: "2014-01-14",
      fechaFinPublicacion: "2014-01-19",
      gustaUsuario: "heart-empty",
      superPromo: false,
      cantidad: 3,
      promoDestacada: false,
      visible: true
    });
    return __Model.UserData.getUserData();
  });

}).call(this);
